<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>멍탐정 AI - 아키텍처 개요</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.0.5/dist/reset.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.0.5/dist/reveal.css"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.0.5/dist/theme/night.css"
      id="theme"
    />

    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css"
    />

    <style>
      /* 사용자 정의 스타일 */
      :root {
        --r-main-font-size: 36px;
        font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui,
          Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo",
          "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol", sans-serif;
      }
      .reveal h1,
      .reveal h2,
      .reveal h3 {
        text-transform: none; /* 제목의 영문 자동 대문자 변환 비활성화 */
      }
      .reveal .slides section {
        text-align: left; /* 슬라이드 기본 정렬을 왼쪽으로 설정 */
      }
      .reveal h1,
      .reveal h2,
      .reveal h3,
      .reveal h4 {
        text-align: center; /* 제목들은 가운데 정렬 */
      }
      .reveal .mermaid {
        text-align: center;
        font-size: 0.7em;
        background-color: transparent;
      }
      .reveal pre {
        width: 100%;
      }
      .reveal pre code {
        max-height: 500px; /* 코드 블록의 최대 높이를 지정하여 스크롤 생성 */
      }
      .reveal section img.placeholder {
        border: 2px dashed #555;
        background-color: rgba(255, 255, 255, 0.05);
      }
      #part-title-display {
        position: fixed;
        top: 25px;
        right: 35px;
        font-size: 16px;
        font-weight: bold;
        color: #ddd;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 5px 12px;
        border-radius: 15px;
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s, visibility 0.4s;
      }
      #part-title-display.visible {
        opacity: 1;
        visibility: visible;
      }

      /* 로딩 인디케이터 스타일 */
      #loading-indicator {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: #1c1e20; /* night 테마와 유사한 배경색 */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: #eee;
        font-size: 1.5em;
        transition: opacity 0.5s, visibility 0.5s; /* 부드러운 사라짐 효과 */
      }
      #loading-indicator.hidden {
        opacity: 0;
        visibility: hidden;
      }
      .spinner {
        margin-bottom: 20px;
        border: 5px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        border-top-color: #fff;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div id="loading-indicator">
      <div class="spinner"></div>
      <p>프레젠테이션을 불러오는 중입니다...</p>
    </div>

    <div class="reveal">
      <div id="part-title-display"></div>
      <div class="slides" id="slides-container"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/customcontrols/plugin.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/customcontrols/style.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/chalkboard/plugin.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/chalkboard/style.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.0.5/dist/reveal.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/highlight/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/notes/notes.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-mermaid-plugin@11.6.0/plugin/mermaid/mermaid.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/zoom/zoom.min.js"></script>

    <script>
      /**
       * 개별 HTML 파일을 비동기적으로 불러와 슬라이드 컨테이너에 삽입하는 함수입니다.
       */
      async function loadSlides(files) {
        const container = document.getElementById("slides-container");
        for (const file of files) {
          try {
            const res = await fetch(file);
            if (!res.ok) continue;

            const html = await res.text();
            const temp = document.createElement("div");
            temp.innerHTML = html.trim();

            while (temp.firstChild) {
              container.appendChild(temp.firstChild);
            }
          } catch (e) {
            console.warn(file + " 불러오기 실패:", e);
          }
        }
        // 모든 슬라이드 파일 로딩이 끝난 후 Reveal.js를 초기화
        initReveal();

        // 파트 제목 업데이트 로직
        const partTitleDisplay = document.getElementById("part-title-display");
        function updatePartTitle(event) {
          const slideWithTitle =
            event.currentSlide.closest("[data-part-title]");
          const partTitle = slideWithTitle
            ? slideWithTitle.dataset.partTitle
            : "";

          if (partTitle) {
            partTitleDisplay.textContent = partTitle;
            partTitleDisplay.classList.add("visible");
          } else {
            partTitleDisplay.classList.remove("visible");
          }
        }
        Reveal.on("slidechanged", updatePartTitle);
        Reveal.on("ready", updatePartTitle);

        // 로딩이 모두 완료되면 로딩 인디케이터를 숨깁니다.
        const loadingIndicator = document.getElementById("loading-indicator");
        loadingIndicator.classList.add("hidden");
      }

      /**
       * Reveal.js 라이브러리를 초기화하고 각종 설정을 적용하는 함수입니다.
       */
      function initReveal() {
        Reveal.initialize({
          width: 1280,
          height: 1280,
          margin: 0.04,
          minScale: 0.2,
          maxScale: 2.0,
          hash: true,
          center: true,
          plugins: [
            RevealHighlight,
            RevealNotes,
            RevealMermaid,
            RevealMenu,
            RevealZoom,
            RevealChalkboard,
            RevealCustomControls,
          ],
          slideNumber: "c/t",
          customcontrols: {
            controls: [
              {
                icon: '<i class="fa fa-pen-square"></i>',
                title: "Toggle chalkboard (B)",
                action: "RevealChalkboard.toggleChalkboard();",
              },
              {
                icon: '<i class="fa fa-pen"></i>',
                title: "Toggle notes canvas (C)",
                action: "RevealChalkboard.toggleNotesCanvas();",
              },
            ],
          },
          mermaid: {},
          chalkboard: {},
          menu: {
            side: "left",
            numbers: true,
            markers: true,
            transitions: true,
          },
        });
        Reveal.on("ready", (event) => {
          try {
            Reveal.layout();
          } catch (e) {
            console.error("Error on Reveal.layout(): ", e);
          }
        });
      }

      /**
       * DOM 로드 완료 후, 동적으로 슬라이드를 탐색하고 불러옵니다.
       */
      window.addEventListener("DOMContentLoaded", async () => {
        const slideFiles = [];
        const MAX_SLIDES = 200; // 무한 루프 방지를 위한 최대 슬라이드 검색 개수

        /**
         * 파일 존재 여부를 확인하고, 존재하면 목록에 추가하는 헬퍼 함수
         */
        const addSlideIfExists = async (filename) => {
          try {
            const response = await fetch(filename, { method: "HEAD" });
            if (response.ok) {
              slideFiles.push(filename);
              return true;
            }
            return false;
          } catch (e) {
            console.error(`Error checking file ${filename}:`, e);
            return false;
          }
        };

        for (let i = 0; i <= MAX_SLIDES; i++) {
          // 1. 기본 슬라이드(slideN.html) 확인
          const mainSlideFile = `slides/slide${i}.html`;
          const mainSlideExists = await addSlideIfExists(mainSlideFile);

          // 2. 하위 슬라이드(slideN-M.html) 확인
          if (mainSlideExists) {
            for (let j = 0; j < 20; j++) {
              // 하위 슬라이드는 최대 20개까지 확인
              const subSlideFile = `slides/slide${i}-${j}.html`;
              const subSlideExists = await addSlideIfExists(subSlideFile);
              if (!subSlideExists) {
                break; // 해당 번호의 하위 슬라이드가 더이상 없으면 중단
              }
            }
          }

          // 3. 연속된 번호의 기본 슬라이드가 없으면 탐색 종료
          if (i > 0 && !mainSlideExists) {
            // 연속성이 깨졌으므로 탐색을 중단하여 불필요한 요청 방지
            break;
          }
        }

        console.log("Found slides:", slideFiles);
        loadSlides(slideFiles);
      });
    </script>
  </body>
</html>
